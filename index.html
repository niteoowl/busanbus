<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ë¶€ì‚° ë²„ìŠ¤ ë„ì°©ì •ë³´ ì¡°íšŒ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            text-align: center;
            background: transparent;
            padding: 30px;
            border-radius: 0;
            box-shadow: none;
            width: 90%;
            max-width: 500px;
        }

        h1 {
            margin-bottom: 20px;
            font-size: 24px;
        }

        select, input[type="text"], button {
            padding: 10px;
            margin: 5px;
            border-radius: 6px;
            border: 1px solid #ccc;
            width: calc(100% - 120px);
            max-width: 400px;
        }

        button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            width: 100px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .result-area {
            margin-top: 20px;
            text-align: left;
        }

        .bus-card {
            background: #ffffff;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px; /* í…Œë‘ë¦¬ ë‘¥ê¸€ê²Œ ì ìš© */
            box-shadow: none;
            position: relative;
            border: 1px solid #ccc;
        }

        .bus-card h3 {
            margin-top: 0;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .bus-card p {
            margin-bottom: 5px;
            font-size: 14px;
        }

        .time-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .time-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ffdb58;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            font-weight: bold;
        }

        .station-info {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
            flex-wrap: nowrap;
            overflow-x: auto;
        }

        .station-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #81c784;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            margin: 0 5px;
            flex: 0 0 auto;
        }

        .current-station {
            background-color: #f44336;
        }

        .bus-icon {
            width: 30px;
            height: 30px;
            background-color: #007bff;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 16px;
            content: 'ğŸš';
            line-height: 30px;
        }

        .icon-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #2196f3;
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            z-index: 1;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>ë¶€ì‚° ë²„ìŠ¤ ë„ì°©ì •ë³´ ì¡°íšŒ</h1>
        <select id="searchType">
            <option value="arsno">ì •ë¥˜ì†Œ ARSë²ˆí˜¸</option>
            <option value="busno">ë²„ìŠ¤ ë²ˆí˜¸</option>
            <option value="stopname">ì •ë¥˜ì†Œ ì´ë¦„</option>
        </select>
        <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        <button onclick="searchBus()">ê²€ìƒ‰</button>
        <div id="result" class="result-area"></div>
    </div>

    <script>
        const serviceKey = 'E3Eos3zdsfvVFG4mC5qYCljIz3vEjbgfHA0Xnyl4zU7eXYLNaN5Tf9%2FqBILOxzpU%2BMztJyUivBxXfKAnK3lg6w%3D%3D';

        function searchBus() {
            const searchType = document.getElementById('searchType').value;
            const searchInput = document.getElementById('searchInput').value.trim();
            const resultDiv = document.getElementById('result');

            if (!searchInput) {
                alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }

            resultDiv.innerHTML = 'ê²€ìƒ‰ ì¤‘...';

            let url = "";

            if (searchType === 'arsno') {
                url = `https://apis.data.go.kr/6260000/BusanBIMS/bitArrByArsno?serviceKey=${serviceKey}&arsno=${searchInput}`;
            } else if (searchType === 'busno') {
                url = `https://apis.data.go.kr/6260000/BusanBIMS/busInfo?serviceKey=${serviceKey}&lineno=${searchInput}`;
            } else if (searchType === 'stopname') {
                url = `https://apis.data.go.kr/6260000/BusanBIMS/busStopList?serviceKey=${serviceKey}&bstopnm=${encodeURIComponent(searchInput)}`;
            }

            fetch(url)
                .then(response => response.text())
                .then(str => (new window.DOMParser()).parseFromString(str, "text/xml"))
                .then(data => {
                    const items = data.getElementsByTagName('item');
                    if (items.length === 0) {
                        resultDiv.innerHTML = '<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                        return;
                    }

                    resultDiv.innerHTML = '';

                    Array.from(items).forEach(item => {
                        let content = "";

                        if (searchType === 'arsno') {
                            const lineno = item.getElementsByTagName('lineno')[0]?.textContent || '-';
                            const nodenm = item.getElementsByTagName('nodenm')[0]?.textContent || '-';
                            const min1 = item.getElementsByTagName('min1')[0]?.textContent || '-';
                            const station1 = item.getElementsByTagName('station1')[0]?.textContent || '-';
                             const carno1 = item.getElementsByTagName('carno1')[0]?.textContent || '-';
                            const formattedMin1 = min1 ? `<div class="time-circle">${min1}</div>ë¶„ í›„` : '-'; // ë³€ê²½ëœ ë¶€ë¶„

                            content = `
                                <div class="icon-badge">ì •ë¥˜ì†Œ ë„ì°© ì •ë³´</div>
                                <h3>ë²„ìŠ¤ ë²ˆí˜¸: ${lineno}</h3>
                                <p>ì •ë¥˜ì†Œ: ${nodenm}</p>
                                <div class="time-info">
                                    ${formattedMin1}
                                    <p>ë„ì°© ì˜ˆì •</p>
                                </div>
                                <div class="station-info">
                                    <span class="station-circle current-station">â‘ </span>
                                    ${generateStationCircles(station1)}
                                    <span class="bus-icon">ğŸš</span>
                                </div>
                                 <p>ì°¨ëŸ‰ ë²ˆí˜¸: ${carno1}</p>
                            `;
                        } else if (searchType === 'busno') {
                            const lineno = item.getElementsByTagName('buslinenum')[0]?.textContent || '-';
                            const bustype = item.getElementsByTagName('bustype')[0]?.textContent || '-';
                            const startpoint = item.getElementsByTagName('startpoint')[0]?.textContent || '-';
                            const endpoint = item.getElementsByTagName('endpoint')[0]?.textContent || '-';
                             const firsttime = item.getElementsByTagName('firsttime')[0]?.textContent || '-';
                            const endtime = item.getElementsByTagName('endtime')[0]?.textContent || '-';

                            content = `
                                 <div class="icon-badge">ë²„ìŠ¤ ê¸°ë³¸ ì •ë³´</div>
                                <h3>ë²„ìŠ¤ ë²ˆí˜¸: ${lineno}</h3>
                                <p>ë²„ìŠ¤ ì¢…ë¥˜: ${bustype}</p>
                                <p>ê¸°ì : ${startpoint}</p>
                                <p>ì¢…ì : ${endpoint}</p>
                                <p>ì²«ì°¨: ${firsttime}</p>
                                <p>ë§‰ì°¨: ${endtime}</p>
                            `;
                        } else if (searchType === 'stopname') {
                            const bstopnm = item.getElementsByTagName('bstopnm')[0]?.textContent || '-';
                            const arsno = item.getElementsByTagName('arsno')[0]?.textContent || '-';
                            const gpsx = item.getElementsByTagName('gpsx')[0]?.textContent || '-';
                            const gpsy = item.getElementsByTagName('gpsy')[0]?.textContent || '-';
                            const stoptype = item.getElementsByTagName('stoptype')[0]?.textContent || '-';

                            // ì •ë¥˜ì†Œ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰ì‹œ ë²„ìŠ¤ ë„ì°© ì •ë³´ë„ í•¨ê»˜ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ URL ë³€ê²½
                            url = `https://apis.data.go.kr/6260000/BusanBIMS/bitArrByArsno?serviceKey=${serviceKey}&arsno=${arsno}`;

                            fetch(url)  // ë³€ê²½ëœ URLë¡œ ë‹¤ì‹œ ìš”ì²­
                                .then(response => response.text())
                                .then(str => (new window.DOMParser()).parseFromString(str, "text/xml"))
                                .then(arrivalData => {
                                    const arrivalItems = arrivalData.getElementsByTagName('item');
                                    let arrivalInfo = "";
                                    if (arrivalItems.length > 0) {
                                        Array.from(arrivalItems).forEach(arrivalItem => {
                                            const lineno = arrivalItem.getElementsByTagName('lineno')[0]?.textContent || '-';
                                            const min1 = arrivalItem.getElementsByTagName('min1')[0]?.textContent || '-';
                                            const station1 = arrivalItem.getElementsByTagName('station1')[0]?.textContent || '-';
                                             const carno1 = arrivalItem.getElementsByTagName('carno1')[0]?.textContent || '-';
                                            const formattedMin1 = min1 ? `<div class="time-circle">${min1}</div>ë¶„ í›„` : '-'; // ë³€ê²½ëœ ë¶€ë¶„
                                            arrivalInfo += `
                                                <div class="time-info">
                                                    ${formattedMin1}
                                                    <p><strong>${lineno}</strong>ë²ˆ ë²„ìŠ¤ ë„ì°© ì˜ˆì • (</p>
                                                 </div>
                                                <div class="station-info">
                                                    <span class="station-circle current-station">â‘ </span>
                                                    ${generateStationCircles(station1)}
                                                    <span class="bus-icon">ğŸš</span>
                                                </div>
                                                 <p>ì°¨ëŸ‰ ë²ˆí˜¸: ${carno1})</p>
                                            `;
                                        });
                                    } else {
                                        arrivalInfo = "<p>ë„ì°© ì˜ˆì •ì¸ ë²„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
                                    }

                                    content = `
                                        <div class="icon-badge">ì •ë¥˜ì†Œ ê¸°ë³¸ ì •ë³´</div>
                                        <h3>ì •ë¥˜ì†Œëª…: ${bstopnm}</h3>
                                        <p>ARSë²ˆí˜¸: ${arsno}</p>
                                        <p>GPS ìœ„ì¹˜: ${gpsx}, ${gpsy}</p>
                                        <p>ì •ë¥˜ì†Œ ìœ í˜•: ${stoptype}</p>
                                        ${arrivalInfo}
                                    `;

                                    const card = document.createElement('div');
                                    card.className = 'bus-card';
                                    card.innerHTML = content;
                                    resultDiv.appendChild(card);
                                })
                                .catch(error => {
                                    console.error('Error fetching arrival data:', error);
                                    resultDiv.innerHTML += '<p>ë„ì°© ì •ë³´ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
                                     const card = document.createElement('div');
                                    card.className = 'bus-card';
                                    card.innerHTML = content;
                                    resultDiv.appendChild(card);
                                });
                            return;
                        }

                        const card = document.createElement('div');
                        card.className = 'bus-card';
                        card.innerHTML = content;
                        resultDiv.appendChild(card);
                    });
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    resultDiv.innerHTML = '<p>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>';
                });
        }

        function generateStationCircles(stationCount) {
            let circles = '';
            for (let i = 1; i <= stationCount; i++) {
                circles += `<span class="station-circle">${i + 1}</span>`;
            }
            return circles;
        }
    </script>
</body>
</html>
